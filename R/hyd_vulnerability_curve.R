#' Hydraulic vulnerability curve
#'
#' Calculates the conductivity of the hydraulic pathway (stem or leaf) as a function 
#' of water potential, using a 2-parameter Weibull function to describe the hydraulic 
#' vulnerability curve:
#' \deqn{P(\psi) = (1/2)^((\psi/\psi_50)^b) }
#'
#' @param psi numeric, Water potential (Mpa)
#' @param psi50 numeric, Water potential at which 50\% conductivity is lost (Mpa)
#' @param b numeric, Slope of the vulnerability curve
#'
#' @return Fractional conductivity
#'
#' @export
#' 
P <- function(psi, psi50, b){
  0.5^((psi/psi50)^b)
}

#' @describeIn P First derivative of the vulnerability curve
Pprime = function(psi, psi50, b){
  log(0.5)*P(psi, psi50, b)*b*(psi/psi50)^(b-1)/psi50
}

#'@describeIn P Second derivative of the vulnerability curve
Pprimeprime = function(psi, psi50, b){
  log(0.5)*b*(psi/psi50)^(b-1)/psi50*Pprime(psi, psi50, b) + log(0.5)*P(psi, psi50, b)/psi50^2*b*(b-1)*(psi/psi50)^(b-2)
}
